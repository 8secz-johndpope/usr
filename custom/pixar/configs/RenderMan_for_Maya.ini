#
# -------------------------------------------------------------------------
# RenderMan_for_Maya.ini $Revision: #8 $
#   This file contains required initialization settings for RenderMan_for_Maya.
#   We suggest that you not edit this file, but rather place overrides and
#   extensions in a file of the same name located in your prefs directory.
#   Please refer to documentation pertaining to RMS_SCRIPT_PATHS.
#--------------------------------------------------------------------------
#

SetPref AvailableRenderers {Reyes RIS}; # RIS, Reyes or both: {RIS Reyes}
SetPref PreferredRenderer RIS; # Active renderer when RfM plug-in loads

SetPref BatchCompileMode lazy; # lazy, zealous

SetPref DisableSwatchRender 0;
#  changed by mattg from 0 to 1 
SetPref DisableRifShaderAttachment 0
SetPref DisableCacheInZip 0

# The Job Phase Tree represents the dependencies between Job Phases.
# Individual rendering passes and other commands (texture conversion,
# file cleanup, etc.) can be stored within a known phase.  Phases
# can be repeated according to the Job Settings.

SetPref JobPhaseTree {
    /Job
    /Job/Preamble -referenceFrame _JobSettings
    /Job/Preflight -referenceFrame _JobSettings
    /Job/Preflight/Prerender
    /Job/Preflight/Maps
    /Job/Preflight/Maps/Shadow
    /Job/Preflight/Maps/Photon
    /Job/Preflight/Maps/GlobalDiffuse
    /Job/Preflight/Maps/Subsurface
    /Job/Preflight/Maps/SlimBake
    /Job/Preflight/Maps/Environment
    /Job/Preflight/Maps/Reflection
    /Job/Preflight/Maps/Reference
    /Job/Preflight/Images
    /Job/Preflight/Cleanup
    /Job/Frames -repeat _JobSettings
    /Job/Frames/Prerender
    /Job/Frames/Maps
    /Job/Frames/Maps/Shadow
    /Job/Frames/Maps/Photon
    /Job/Frames/Maps/GlobalDiffuse
    /Job/Frames/Maps/Subsurface
    /Job/Frames/Maps/SlimBake
    /Job/Frames/Maps/Environment
    /Job/Frames/Maps/Reflection
    /Job/Frames/Maps/Reference
    /Job/Frames/Images
    /Job/Frames/Cleanup
    /Job/Cleanup
}
# These are the job phases that are required to exist.
SetPref JpJob /Job
SetPref JpPreamble /Job/Preamble
SetPref JpPreflightCleanup  /Job/Preflight/Cleanup
SetPref JpFramePrerender /Job/Frames/Prerender
SetPref JpFrameCleanup /Job/Frames/Cleanup
SetPref JpCleanup /Job/Cleanup

# The PassRefValidityTable maps each pass class to a list of
# classes in which such a reference would be valid.  For example, Shadow
# passes may be referenced by shaders in Final passes, but it wouldn't
# make sense for Shadow passes to be referenced by shaders in Shadow passes.
# When shader parameters containing pass references are output at render 
# time this table is used to determine which pass references to expand.

SetPref PassRefValidityTable {
    TxMake {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender Shadow DeepShadow \
            AreaShadow SSRender RenderGlobalDiffuse3d RenderApproxGlobalDiffuse \
            RenderCaustic ScatterVolumeRender}
    Reference {}

    Shadow {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender SSRender \
	RenderRadiosity RenderGlobalDiffuse3d ScatterVolumeRender}
    MinMaxShadow {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender SSRender \
	RenderRadiosity RenderGlobalDiffuse3d ScatterVolumeRender}
    DeepShadow {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender SSRender \
	RenderRadiosity RenderGlobalDiffuse3d ScatterVolumeRender}
    AreaShadow {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender SSRender \
	RenderRadiosity RenderGlobalDiffuse3d ScatterVolumeRender}
    
    RenderGlobalDiffuse3d {RenderGlobalDiffuse3d MakeGlobalDiffuse3d}
    MakeGlobalDiffuse3d {MakeGlobalDiffuse3d Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender \
	ReferenceRender Reflection SSRender ScatterVolumeRender}
    
    RenderRadiosity {RenderRadiosity RenderApproxGlobalDiffuse \
	Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection SSRender \
        FilterApproxGlobalDiffuse PartialFilterApproxGlobalDiffuse}
    RenderApproxGlobalDiffuse {RenderApproxGlobalDiffuse \
        MakeApproxGlobalDiffuse RenderRadiosity}
    MakeApproxGlobalDiffuse { MakeApproxGlobalDiffuse \
	Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection SSRender}
    MakeFilterApproxGlobalDiffuse { MakeFilterApproxGlobalDiffuse \
	Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection SSRender}
    FilterApproxGlobalDiffuse { FilterApproxGlobalDiffuse \
	RenderRadiosity Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection SSRender}
    PartialFilterApproxGlobalDiffuse { PartialFilterApproxGlobalDiffuse \
	RenderRadiosity Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection SSRender}

    RenderCaustic {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection}

    BakeRender {BakeRender}

    SSRender {SSRender SSOrganize SSDiffuse SSMakeBrickmap}
    SSOrganize {SSRender Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender Reflection}
    SSDiffuse {SSRender SSDiffuse SSMakeBrickmap Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender \
        ReferenceRender Reflection}
    SSMakeBrickmap {SSRender SSDiffuse SSMakeBrickmap Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender \
	ReferenceRender Reflection}

    SBRender {SBRender SBPtRender SBMakePtCloud SBMakePtex SBMakeBrickmap}
    SBPtRender {SBRender SBPtRender SBMakePtCloud SBMakePtex SBMakeBrickmap \
        Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender}
    SBMakePtCloud {SBRender SBMakePtCloud \
        Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender}
    SBMakePtex {SBRender SBMakePtex \
        Final FinalDenoise Preview PreviweRIS Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender}
    SBMakeBrickmap {SBRender SBMakeBrickmap \
        Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender}

    ScatterVolumeRender {ScatterVolumeRender VolumeScatter} 
    VolumeScatter {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender ReferenceRender Reflection}

    Reflection {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender ReferenceRender}
    Environment {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender}
    EnvMap {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender}
    EnvCube {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender}
    EnvRender {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender Reflection ReferenceRender}
    ReferenceRender {Final FinalDenoise Preview Rerender RerenderRIS ReyesRerender BakeRender}

    Denoise {Denoise}
    DenoiseCrossFrame {DenoiseCrossFrame}
    Final {Final}
    FinalDenoise {Denoise DenoiseCrossFrame}
    Preview {Preview}
    Rerender  {Rerender}
    RerenderRIS  {RerenderRIS}
    ReyesRerender  {ReyesRerender}
}

SetPref FinalPassClasses {Final Preview Rerender}
SetPref FinalRISPassClasses {Final FinalDenoise RerenderRIS}

# The ImageFormatQuantizationTable allows image format and quantization 
# to be controlled simultaneously so that unsupported combinations can be 
# avoided.  Entries in this table appear as entries in the "Image Format" 
# option menu in the Render Globals.  The first element in each triple is 
# a label.  The second element is an image format, the third is a 
# quantization which will be set when the entry is selected.  The entries
# of the quantization value are for zero, one, min, max, dither.

SetPref ImageFormatQuantizationTable {
    {Alias (alias)} alias {0 255 0 255 0.5}
    {Cineon (cin)} cineon {0 65535 0 65535 0}
    {MayaIFF (iff)} mayaiff {0 255 0 255 0.5}
    {OpenEXR (exr)} openexr {0 0 0 0 0}
    {SGI8 (sgi)} sgif {0 255 0 255 0.5}
    {SGI16 (sgi)} sgif {0 65535 0 65535 0}
    {SoftImage (pic)} softimage {0 255 0 255 0.5}
    {Targa (tga)} targa {0 255 0 255 0.5}
    {Tiff8 (tif)} tiff {0 255 0 255 0.5}
    {Tiff16 (tif)} tiff {0 65535 0 65535 0}
    {Tiff32 (tif)} tiff {0 0 0 0 0}
    {Texture8 (tex)} texture {0 255 0 255 0.5}
    {Texture16 (tex)} texture {0 65535 0 65535 0}
    {Texture32 (tex)} texture {0 0 0 0 0}
    {DeepImage (dtex)} deepshad {0 0 0 0 0}
    {It8 (it)} it {0 255 0 255 0.5}
    {It16 (it)} it {0 65535 0 65535 0}
    {It32 (it)} it {0 0 0 0 0}
}

SetPref Framebuffer internal; # alternatively: external

# Prefs which begin with RManPreset_## will appear as entries in the 
# Render Settings window under the Presets->Load Preset menu.
# Each collection of presets can include any number of global settings
# which should be set accordingly when the preset is loaded.
# Reyes and RIS settings can be mixed.  Only the relevant ones
# for the current renderer will be applied.
SetPref RManPreset_01_Draft {
    settings:job:Job ShadingRate 10
    settings:job:Job PixelSamples {3 3}
    settings:job:Job trace:maxdepth 4
    settings:job:Job trace:maxspeculardepth 2
    settings:job:Job trace:maxdiffusedepth 1
    settings:job:Job shading:directlightingsamples 10
    pass:render:Shadow ShadingRate 10
    pass:render:DeepShadow ShadingRate 10
    pass:render:DeepShadow PixelSamples {3 3}
    settings:job:RISJob Hider:maxsamples 4
    settings:job:RISJob trace:maxspeculardepth 2
    settings:job:RISJob trace:maxdiffusedepth 1
}

SetPref RManPreset_02_Intermediate {
    settings:job:Job ShadingRate 2
    settings:job:Job PixelSamples {5 5}
    settings:job:Job trace:maxdepth 4
    settings:job:Job trace:maxspeculardepth 2
    settings:job:Job trace:maxdiffusedepth 1
    settings:job:Job shading:directlightingsamples 50
    pass:render:Shadow ShadingRate 2
    pass:render:DeepShadow ShadingRate 2
    pass:render:DeepShadow PixelSamples {3 3}
    settings:job:RISJob Hider:maxsamples 16
    settings:job:RISJob trace:maxspeculardepth 2
    settings:job:RISJob trace:maxdiffusedepth 1
}

SetPref RManPreset_03_Production {
    settings:job:Job ShadingRate 1
    settings:job:Job PixelSamples {11 11}
    settings:job:Job trace:maxdepth 10
    settings:job:Job trace:maxspeculardepth 4
    settings:job:Job trace:maxdiffusedepth 1
    settings:job:Job shading:directlightingsamples 100
    pass:render:Shadow ShadingRate 1
    pass:render:DeepShadow ShadingRate 1
    pass:render:DeepShadow PixelSamples {5 5}
    settings:job:RISJob Hider:maxsamples 256
    settings:job:RISJob trace:maxspeculardepth 4
    settings:job:RISJob trace:maxdiffusedepth 1
}

# A menu of these spool styles appears in the Maya batch render dialog window.
# These pairs consist of a label and a mel script. The mel script must return 
# the name of the alfred job script that it generates.
SetPref AlfredSpoolScripts {
    "mayabatch local" rmanSpoolMayaLocal
    "mayabatch remote" rmanSpoolMayaRemote
}

SetPref TractorDashboardURL {http://tractor-monitor/tractor/dashboard/}
SetPref TractorEngine {tractor-engine:80}
SetPref TractorUser {}

SetPref DefaultEnvKey \
    "rms-[GetVersion product]-maya-[GetPlatform rfm_mayaversion]"

# We rely on you setting your path to alfred or tractor
SetPref alfredLaunchPath alfred;

SetPref LocalQueueLaunchPath [file join $RMSTREE bin LocalQueue]
SetPref ptrenderLaunchPath [file join $RMSTREE rmantree bin ptrender]

switch $::tcl_platform(os) {
    "Darwin" {
        SetPref itLaunchPath [file join $RMSTREE bin it.app Contents MacOS it]
    }
    default {
        SetPref itLaunchPath [file join $RMSTREE bin it]
    }
}

# A list of default rifs.
# RfM relies on RLFInjector to be in this list.
# Rif args can be supplied using the -rifargs flag:
# eg. "-rif RLFInjector -rifargs -filtergeom 1 -rifend"
SetPref DefaultRifs {
    "-rif RLFInjector -rifend"
}

# The outputs listed below in the OutputClasses pref will appear in the menu
# for adding outputs under the Passes tab.  The names listed
# here correspond to declared display channels.  You may add your own type of
# output to this list.
SetPref StdAOVs {
    "normal N"
    "normal Ng"
    "point P"
    "float s"
    "float t"
    "float u"
    "float v"
    "color Cs"
    "color Os"
    "color Ci"
    "color Oi"
    "float a"
    "vector dPdtime"
    "float __CPUtime"
}
SetPref RISStdAOVs {
    "point P"
    "float PRadius"
    "normal Nn"
    "normal Ngn"
    "vector Tn"
    "vector Vn"
    "float VLen"
    "float curvature"
    "float incidentRaySpread"
    "float mpSize"
    "float u"
    "float v"
    "float w"
    "float du"
    "float dv"
    "float dw"
    "vector dPdu"
    "vector dPdv"
    "vector dPdw"
    "vector dPdtime"
    "float dufp"
    "float dvfp"
    "float dwfp"
    "float id"
    "float z"
}
SetPref MayaAOVs {
    "color GlowColor"
}
# these CompAOVs are directly supported by Factory templates and nodes.
SetPref CompAOVs {
    "color Ambient"
    "color DiffuseColor"
    "color DiffuseDirect"
    "color DiffuseDirectShadow"
    "color DiffuseIndirect"
    "color DiffuseEnvironment"
    "color SpecularColor"
    "color SpecularDirect"
    "color SpecularDirectShadow"
    "color SpecularIndirect"
    "color SpecularEnvironment"
    "color Backscattering"
    "color Incandescence"
    "color Refraction"
    "color Rim"
    "color Translucence"
    "color Subsurface"
    "color OcclusionDirect"
    "color OcclusionIndirect"
}

SetPref BakeAOVs {
    "color _indirectdiffuse"
    "float _occlusion"
    "vector _environmentdir"
    "float _area"
    "color _radiosity"
    "color _extinction"
    "color _radiance_t"
    "color _albedo"
    "color _diffusemeanfreepath"
    "float _float"
    "color _color"
}

SetPref GPAOVs {
    "point wP"
    "normal wN"
    "float Z"
    "color Diffuse"
    "color DiffuseShadow"
    "color Specular"
    "color SpecularShadow"
    "color DiffuseIndirect"
    "color SpecularIndirect"
    "color Incandescence"
    "color Subsurface"
    "color Refraction"
    "float id"
    "float Occlusion"
}

# Each entry in RIS*AOVs prefs below can take the form of either "type name"
# or {"type name" {type source}}
SetPref RISAOVs {
    "color lpe:diffuse"
    "color lpe:specular"
    "color lpe:emission"
    "color lpe:indirectdiffuse"
    "color lpe:indirectspecular"
    "color lpe:reflectioncollector"
    "color lpe:shadowcollector"
    "color lpe:subsurface"
    "color lpe:refraction"
    "color lpe:unoccluded;diffuse"
    "color lpe:unoccluded;specular"
    "color lpe:unoccluded;indirectdiffuse"
    "color lpe:unoccluded;indirectspecular"
    "color lpe:unoccluded;subsurface"
    "color lpe:unoccluded;refraction"
    {"color lpe:beauty" {color lpe:C[DS]*<L.>}}
    {"color lpe:diffuse_custom" {color lpe:CD<L.>}}
    {"color lpe:specular_custom" {color lpe:CS<L.>}}
    {"color lpe:emission_custom" {color lpe:CO}}
    {"color lpe:indirectdiffuse_custom" {color lpe:C<RD>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:indirectspecular_custom" {color lpe:C<RS>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:reflectioncollector_custom" {color lpe:C<RS'collector'>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:shadowcollector_custom" {color lpe:shadows;C\[<.D'collector'><.S'collector'>\]<L.>}}
    {"color lpe:subsurface_custom" {color lpe:C<TD>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:refraction_custom" {color lpe:C<T\[GS\]>(\[DS\]+<L.>)|(\[DS\]*O)}}
}

# need to insert holdout; after lpe:
SetPref RISHoldoutAOVs {
    {"color lpe:holdout_shadows" {color lpe:holdout;shadows;C\[<.D'collector'><.S'collector'>\]<L.>}}
    {"color lpe:holdout_reflections" {color lpe:holdout;C<RS'collector'>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:holdout_indirectdiffuse" {color lpe:holdout;C<RD'collector'>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:holdout_subsurface" {color lpe:holdout;C<TD'collector'>(\[DS\]+<L.>)|(\[DS\]*O)}}
    {"color lpe:holdout_refraction" {color lpe:holdout;C<T\[S'collector'\]>(\[DS\]+<L.>)|(\[DS\]*O)}}
}

SetPref RISDenoiseAOVs {
    "color Ci"
    "float a"
    {"color mse" {color Ci}}
    {"color albedo" {color lpe:nothruput;noinfinitecheck;noclamp;unoccluded;overwrite;C(U2L)|O}}
    {"color diffuse" {color lpe:C(D\[DS\]*\[LO\])|O}}
    {"color diffuse_mse" {color lpe:C(D\[DS\]*\[LO\])|O}}
    {"color specular" {color lpe:CS\[DS\]*\[LO\]}}
    {"color specular_mse" {color lpe:CS\[DS\]*\[LO\]}}
    {"float z" {float z}}
    {"float z_var" {float z}}
    {"normal normal" {normal Nn}}
    {"normal normal_var" {normal Nn}}
    {"vector forward" {vector motionFore}}
}

SetPref RISMatteAOVs {
    "color MatteID0"
    "color MatteID1"
    "color MatteID2"
    "color MatteID3"
    "color MatteID4"
    "color MatteID5"
    "color MatteID6"
    "color MatteID7"
}

foreach aov [concat [GetPref StdAOVs] [GetPref CompAOVs] \
                    [GetPref MayaAOVs] [GetPref GPAOVs]] {
    foreach {type nm} $aov {
	lappend aovNames $nm
    }
}
SetPref OutputClasses $aovNames

foreach aov [concat [GetPref RISStdAOVs] \
                    [GetPref RISAOVs]] {
    foreach {type nm} $aov {
	lappend aovNamesRIS $nm
    }
}
SetPref RISOutputClasses $aovNamesRIS

# These are the AOV prefs which will appear in the RenderMan Controls
SetPref ReyesAOVTabs {
    "Standard" StdAOVs
    "AP Comp" CompAOVs
    "GP Comp" GPAOVs
    "Maya" MayaAOVs
}

SetPref RISAOVTabs {
    "Standard" RISStdAOVs
    "LPE" RISAOVs
    "Matte" RISMatteAOVs
}

SetPref CreateMenuPassClasses {
    "Final"
    "Preview"
    "TxMake"
    "Denoise"
    "DenoiseCrossFrame"
}

# Folks who never like polygons, can set rmanMeshRep to subdiv
# You can also override the interpretation of polygon meshes with
# a per-mesh attribute rmanSubdiv (or mtorSubdiv):  0: mesh, 1: subdiv
SetPref rmanMeshRep mesh

# Setting the FurStyle pref to legacy causes RfM to ignore 
# equalizer maps and calc area values.
#SetPref FurStyle legacy

# Load critical RfM interface definition files.  
set rfmLibDir [file join [RATGetDir lib] rfm]
set cfg $rfmLibDir

# Load RfM-specific extensions to RMSExpression
LoadExtension tcl [file join $cfg RfMExpression.tcl]
LoadExtension tcl [file join $cfg RfMPassExpression.tcl]
LoadExtension tcl [file join $cfg RfMWorkExpression.tcl]

# first define known options, attributes and shader parameters
LoadExtension rman [file join $cfg decl_torcontrols.rman]
LoadExtension rman [file join $cfg decl_rioptions.rman]
LoadExtension rman [file join $cfg decl_riattributes.rman]
LoadExtension rman [file join $cfg decl_cmdparams.rman]
LoadExtension rman [file join $cfg decl_shaderparameters.rman]

# node definitions, nodes_base.rman defines some common collections
# that are referenced by other nodes_ files and so should precede others.
LoadExtension rman [file join $cfg nodes_base.rman]
LoadExtension rman [file join $cfg nodes_rif.rman]
LoadExtension rman [file join $cfg nodes_shadow.rman]
LoadExtension rman [file join $cfg nodes_globalillum.rman]
LoadExtension rman [file join $cfg nodes_subsurf.rman]
LoadExtension rman [file join $cfg nodes_envlight.rman]
LoadExtension rman [file join $cfg nodes_envmap.rman]
LoadExtension rman [file join $cfg nodes_volumescatter.rman]

# optional parameters for maya nodes
LoadExtension rman [file join $cfg nodeoptions.rman]

# now define renderman globals interface
LoadExtension rman [file join $cfg gui.rman]
RAT::LogMsg DEBUG "UTS overrides  loaded!"


############### now load the custom uts open exr overrides
set utsoverrides [file join [GetEnv RDIR {default {"/Volumes/dabrender/usr/custom/pixar/configs"}}] "uts_overrides.rman"]
LoadExtension rman $utsoverrides
 

# now load known shader node emulators:
#   all files whose names don't begin with _ represent shading nodes.
set mayaNodesDir [file join $rfmLibDir rsl mayaNodes]
foreach f [glob -nocomplain -- [file join $mayaNodesDir *.h]] {
    if {![string match _* [file tail $f]]} {
        LoadExtension rslt $f
    }
}

set customNodesDir [file join $rfmLibDir rsl customNodes]
foreach f [glob -nocomplain -- [file join $customNodesDir *.{sl,h}]] {
    if ![string match _* [file tail $f]] {
        LoadExtension rslt $f
    }
}

# RfM output dirs are controlled via RMS.ini

# By default: we use the shader compiler that ships with RfM.  You
# can override this command to point to an alternate version. Be aware
# that the internal version of prman may not be compatible with the
# output of an alternate compiler version.
# The form is that of a proper tcl list of arguments.  We employ tcl's 
# list command because RMSTREE can include spaces. 
# The standard include paths point to the internal locations of shadeop 
# plugins and factory templates. You can override factory templates by
# ensuring that your custom template directory precedes the factory
# directory in the searchpaths.  At compile time we substitute
# the %f token with the generated shader filename.
SetPref ShaderCompiler [list $RMSTREE/rmantree/bin/shader \
                            -I$RMSTREE/lib/shaders \
                            -I$RMSTREE/lib/slim/pxCoreV1 \
                            -I$RMSTREE/lib/rfm/rsl -C %f]
SetPref ShaderCompilerCleanup 1

# The ImplicitTxMake pref codifies how to auto-convert maya image source 
# files to renderman textures.  Currently we support 3 classes of TxMakes
# according to their use-cases in maya shading networks. Explicit
# txmake passes follow a different code-path and provide explicit
# control over txmake parameters.
SetPref ImplicitTxMakeFmts {

environmentLatLong {
  MakeLatLongEnvironment "%s" "%s" "gaussian" 2 2 "newer" [1]}

imageplane {
  MakeTexture "%s" "%s" "black" "black" "separable-catmull-rom" 2 2 \
"newer" [1] "resize" ["up-"]}

texture {
  MakeTexture "%s" "%s" "periodic" "periodic" "separable-catmull-rom" 2 2 \
"newer" [1] "resize" ["up-"]}

_default {
  MakeTexture "%s" "%s" "periodic" "periodic" "separable-catmull-rom" 2 2 \
"newer" [1] "resize" ["up-"]}

}

# A list of file extensions for which texture conversion should be skipped.
# These are useful for users who have preconverted textures and don't want
# them reconverted according to the rules above.
SetPref NoConvertTextureExtensions {tx tex env ptx}

if {[GetPlatform platform] eq "windows"} {
    # By default we make slim behave like a child window of Maya. Set to 0 to
    # return to the rms1 behavior.
    SetPref ParentSlimsWindow 1
}

#
# -------------------------------------------------------------------------
# previously contained in RenderMan_for_Maya_Pro.ini 
#--------------------------------------------------------------------------
#

# Use RPSVersion to specify which version of RPS is being used, if you wish to
# enable features in the UI that aren't supported by the built-in renderer.
#SetPref RPSVersion 16.2

SetPref RIBGenSvc	RfMRibGen
SetPref LocalRenderCmd	{prman -t:0 -Progress -recover %r -checkpoint 0}
SetPref LocalRenderSvc	local:PixarRender
SetPref LocalRfMRenderSvc local:RfMRender
SetPref PreviewRenderCmd {netrender -Progress -f %H}
SetPref PreviewRenderSvc PixarNRM
SetPref RemoteRenderCmd	{prman -t:0 -Progress -recover %r -checkpoint 0}
SetPref RemoteRenderSvc	PixarRender
SetPref RemoteRfMRenderSvc RfMRender
SetPref ShoCmd		sho

# The prefs below which begin with Launch* are used for rerendering;
# prman is launched in piped mode.  ie. commands are piped directly
# to the prman or rerender process.  
# There are a few different variants of the launch command
# depending on whether doing raytraced or reyes rerendering,
# and whether the display is 'it' or the maya render view.
# Raytraced rerenders can use the "rerender" executable that ships with RfM,
# whereas reyes rerenders require stand-alone prman.

# The Rerenderer can either be "raytrace" or "reyes"
SetPref Rerenderer raytrace

set rmantree [GetEnv RMANTREE]
if {$rmantree != {}} {
    if {[file exists $rmantree/bin/prman.exe] == 0 && [file exists $rmantree/bin/prman] == 0} {
        RAT::LogMsg WARNING "Invalid RMANTREE: $rmantree"
        set rmantree $RMSTREE/rmantree
    }
} else {
    set rmantree $RMSTREE/rmantree
}

set prman $rmantree/bin/prman
set it [GetPref itLaunchPath]
set ituri [regsub -all " " $it %20]; # replace spaces in path-to-it

SetPref LaunchRaytraceRerenderCmd "launch:${prman}?"
SetPref LaunchReyesRerenderCmd "launch:${prman}?"
SetPref LaunchStdArgs "-t:0 -Progress -ctrl \$ctrlin \$ctrlout -xcpt \$xcptin"
SetPref LaunchToItArg  "-dspyserver ${ituri}";# pixels to 'it'
SetPref LaunchToRenderViewArg "-dspy \$dspyin \$dspyout";# pixels back over pipe

# alfredLaunchPath:
SetPref alfredLaunchPath {alfred}

# mayaBatchLaunchPath:
#   This is used when maya is launched in batch mode by alfred or tractor.
#   The maya install dir needs to be in your system path or else you
#   need to specify a full path here.
SetPref mayabatchLaunchPath {%D(mayabatch) -batch}

# A menu of these spool styles appears in the Maya batch render dialog window.
# These pairs consist of a label and a mel script. The mel script must return 
# the name of the alfred job script that it generates.  It also needs to do 
# any necessary preliminary work, like immediate RIB generation.
SetPref AlfredSpoolScripts {
    "mayabatch local" rmanSpoolMayaLocal
    "mayabatch remote" rmanSpoolMayaRemote
    "immediate rib, local render" rmanSpoolImmediateRIBLocalRender
    "immediate rib, remote render" rmanSpoolImmediateRIBRemoteRender
    "deferred rib, remote render" rmanSpoolDeferredRIBRemoteRender
    "remote rib, remote render" rmanSpoolRemoteRIBRemoteRender
}

# A menu of these spool styles appears in the render current frame dialog.
SetPref AlfredPreviewSpoolScripts {
    "netrender" rmanSpoolLocalPreviewNetrender
    "local render" rmanSpoolLocalPreviewRender
    "remote render" rmanSpoolRemotePreviewRender
}


set cfgdir [file join [RATGetDir lib] rfm]

# RSL Template Nodes:
#  Pixar has reserved maya node ids: 0x0101261-0x01012ff for our rfm templates
#  Sites should request node id blocks from Alias/Autodesk to prevent 
#  compatibility issues.  Sites should further adopt naming conventions
#  in the form of four-letter prefixes to reduce the risk of template 
#  collision. The prefixes rman and px are reserved by Pixar.
set templdir [file join $cfgdir rsl customNodes]
LoadExtension rslTmplt [file join $templdir rfmManifold.rslt]
LoadExtension rslTmplt [file join $templdir rfmTexture2d.rslt]
LoadExtension rslTmplt [file join $templdir rfmTexture3d.rslt]
LoadExtension rslTmplt [file join $templdir rfmUtility.rslt]

SetPref HelpURLs [list \
 "RMS Docs"  \
   "https://renderman.pixar.com/resources/current/RenderMan/RMS_101.html" \
 "RMS Forums"  \
   "https://renderman.pixar.com/forum/forumdisplay.php?s=&forumid=111" \
 "RPS Forums"  \
   "https://renderman.pixar.com/forum/forumdisplay.php?s=&forumid=23" \
	]

SetPref UpgradeURL "http://renderman.pixar.com/view/NCR-Upgrade"

# ItNodesScript:
# This mel script is responsible for generating the notes that get sent to 
# It. The default script computes a date and time stamp.
SetPref ItNotesScript { rmanItNotesScript }

# DspyParamsScripts:
# A mel script can be specified for each kind of display driver.  
# Each script generates a string which will be passed to the display 
# driver as a param called dspyParams.  "it" recognizes dspyParams.
SetPref DspyParamsScripts {
    "it" {rmanDspyParamsScript "it" "$PASSID" "$PASSCLASS"}
}

SetPref SlimTetherMode tight
# SlimTetherMode controls the style of communication between RfM and Slim.  
# Options:
#     "tight": slim session data is stored in the maya scene file. This mode
#         was introduced in RMS 3.0 and loosely follows the MTOR-Slim
#         style of tethering.
#     "loose": slim session data stored in external slim session files
#         following the AssetStageStrategy preference.
#   The value in this file represents a site-wide tethering policy.

# RfM has its own version of SlimClientExpression.tcl which implements 
# the interface defined by slim's file with the same name.
LoadExtension tcl [file join $cfg SlimClientExpression.tcl]
LoadExtension rman [file join $cfgdir nodes_slimbake.rman]

LoadExtension rman [file join $cfg decl_rioptions19.rman]

# Specify the first maya node ID from a block (ideally assigned to your site),
# and all RIS nodes will incrementally be assigned an ID from this block, 
# ignoring those specified in the args files.  
# This avoids having to individually assign unique IDs in args files, 
# but it could cause incompatibility when sharing binary scene files;
# IDs are only saved in scene files in maya binary format.
#SetPref RISFirstID 0

# The RISNodeTable maps maya node names to implementations as RIS plug-ins.
SetPref RISNodeTable {
    "bifrostAeroMaterial" PxrBifrostAero
    "blendColors" PxrMayaBlendColors
    "bulge" PxrMayaBulge
    "bump2d" PxrMayaBump2d
    "bump3d" PxrMayaBump3d
    "brownian" PxrMayaBrownian
    "checker" PxrMayaChecker
    "clamp" PxrMayaClamp
    "cloth" PxrMayaCloth
    "cloud" PxrMayaCloud
    "condition" PxrCondition
    "contrast" PxrMayaContrast
    "crater" PxrMayaCrater
    "file" PxrMayaFile
    "fluidShape" PxrMayaFluidShape
    "fractal" PxrMayaFractal
    "gammaCorrect" PxrMayaGammaCorrect
    "granite" PxrMayaGranite
    "grid" PxrMayaGrid
    "hairSystem" PxrMayaHair
    "hsvToRgb" PxrMayaHsvToRgb
    "imagePlane" PxrMayaImagePlane
    "layeredTexture" PxrMayaLayeredTexture
    "leather" PxrMayaLeather
    "luminance" PxrMayaLuminance
    "marble" PxrMayaMarble
    "mountain" PxrMayaMountain
    "multiplyDivide" PxrMultiplyDivide
    "noise" PxrMayaNoise
    "place2dTexture" PxrMayaPlacement2d
    "place3dTexture" PxrMayaPlacement3d
    "plusMinusAverage" PxrMayaPlusMinusAverage
    "ramp" PxrMayaRamp
    "remapColor" PxrMayaRemapColor
    "remapHsv" PxrMayaRemapHsv
    "remapValue" PxrMayaRemapValue
    "reverse" PxrMayaReverse
    "rgbToHsv" PxrMayaRgbToHsv
    "rock" PxrMayaRock
    "setRange" PxrMayaSetRange
    "snow" PxrMayaSnow
    "solidFractal" PxrMayaSolidFractal
    "stucco" PxrMayaStucco
    "uvChooser" PxrMayaUVChooser
    "volumeFog" PxrMayaVolumeFog
    "volumeNoise" PxrMayaVolumeNoise
    "wood" PxrMayaWood
}

# Parameter lists and UI hints for RIS bxdf and patterns are defined in 
# xml based "args" files.  These are loaded from the list of directories below.
# Your own directories containing custom args files can be added to this list.
# If you add args files for your own plug-ins to the list, make sure to also 
# visit RMSWorkspace.ini to make corresponding changes to the rix searchpath,
# the path where bxdf and pattern plug-ins are found by prman.
set RISArgsSearchPath [list \
                           [file join $rmantree lib RIS pattern Args] \
                           [file join $rmantree lib RIS bxdf Args] \
                           [file join $rmantree lib RIS light Args] \
                           [file join $cfg ris customNodes] \
                           [file join $cfg ris mayaNodes] \
                          ]

# These are left out of RfM to avoid confusion; prefer PxrGP* equivalents
set excludeList {PxrBxdfBlend PxrDiffuse PxrGlass PxrHair PxrOSL PxrSkin}
SetPref RISArgsExcludeList $excludeList

foreach argspath $RISArgsSearchPath {
    set argsfiles [glob -nocomplain "${argspath}/*.args"]
    foreach argsfile $argsfiles {
        # Args files can be excluded here, but in order to not
        # break existing scenes that use these nodes,
        # they will be filtered out from the create list in hypershade.
        set skip 0
#        foreach exclude $excludeList {
#            if [string match "*/${exclude}.*" $argsfile] {
#                set skip 1
#                break
#            }
#        }
        if !${skip} {
            LoadExtension args "$argsfile"
        }
    }
}

RAT::LogMsg DEBUG "RenderMan_for_Maya.ini loaded!"





