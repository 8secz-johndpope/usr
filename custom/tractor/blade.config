{
    #
    # Configuration profiles for tractor-blade servers
    #
    # On startup, tractor-blade.py on each server requests the contents
    # of this file from the central tractor-engine.  The blade then scans
    # the BladeProfiles LIST below looking for a "Hosts" clause that matches
    # its hostname/platform. The ordering of the list below is important,
    # the FIRST profile that matches is used, and searching ends. Thus,
    # host-specific profiles should typically precede generic ones.
    #
    # Profiles entries in the BladeProfiles list are first initialized
    # from the "ProfileDefaults" entry, if it exists, and then their
    # specific elements are applied as overrides.
    #

    "ProfileDefaults":
    
    {   "ProfileName": "default",
        "Hosts": {"Platform": "*"},
        "Access": {
            "Crews": ["*"],
            "NimbyCrews": ["*"],
            "NimbyConnectPolicy": 1.5
        },
        "NIMBY": 1,
        "Provides": [
                     #"PixarRender", 
                     #"PixarNRM",
                     #"RfMRender", 
                     #"RfMRibGen", 
                     #"PixarMTOR"
                    ],
        "Capacity": {
            "MaxSlots": 1,    # 0 -> use number of system CPUs
            "MaxLoad":  1.0,  # CPU load avg, normalized by cpu count
            "MinRAM":   0.5,  # gigabytes
            "MinDisk":  1.0,  # gigabytes; alternatively: [1.0, "D:/"]
        },
        "UDI": 1.0,

        #"CmdOutputLogging": "logfile=/fileserver/tractor-logs/%u/J%j/T%t.log",
        "CmdOutputLogging": "logserver=tractor-logger:9180",
        # "CmdOutputLogging": "logserver=${TRACTOR_ENGINE}:9180",

        # 5 errs within 30 secs causes 120 second hiatus in requests for work,
        # or use -1 for the third parameter to cause an auto-nimby instead.
        # In the nimby variant, regular processing must then be restored later
        # by an administrator using a manual nimby reset via the Dashboard or tq.
        # Use -1 for the first parameter to disable this feature.
        "RecentErrorThrottle": [5, 30, 120],

        # "DirMapZone": "nfs", # typically blades auto-select "nfs" or "unc"
        #"VersionPin": "@env(TRACTOR_ENGINE_VERSION)",

        "SiteModulesPath": "/Volumes/dabrender/usr/custom/tractor",
        "EnvKeys": [
            {   "keys": ["default"],
                "environment": {},
                "envhandler": "default"
            },
        ]
    },


    "BladeProfiles":
[
        # These profiles are examples showing how to apply
        # potentially different settings to different platforms.
        # You can add more, or reduce it down to just one generic
        # profile if you prefer. The "Platform" strings are
        # compared against the python "platform.platform()"
        # values on the blades.

        # the desired strategy to look at is set every core to be a slot then use min and max slots in
        # the job to get how many threads are given to a job
        #  so min/max = 8 slots for a job needing 8 threads
        #  also it seems 8 is a good number for pixar


        ######  render machines - 64 cores and lots of ram
        {   "ProfileName": "Linux64",
            "Hosts": {"Name": [ 
                                #"dabrn01",
                                #"dabrn02",
                                #"dabrn03",
                                #"dabrn04",
                                #"dabrn05",
                                #"dabrn06",
                                #"dabrn07",
			       ] },
            "UDI":3.0,
            "Provides": [ 
                          #"PixarRender",
                          #"PixarNRM",
                          #"RMSRender",
                          #"ShellServices",
                          #"RfMRender", 
                          #"MayaMentalRay",
                          #"RfMRibGen",
                          #"PixarMTOR",
                          "FAT",
                          ],
            "Capacity": {
               "MaxSlots": 64,    # 0 -> use number of system CPUs
               "MaxLoad":  1.0,  # CPU load avg, normalized by cpu count
<<<<<<< Updated upstream
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
=======
               "MinRAM":   4.0,  # gigabytes
               "MinDisk":  1.0,  # gigabytes; alternatively: [1.0, "D:/"]
>>>>>>> Stashed changes
            },
          
            "CmdOutputLogging": "logserver=tractor-logger:9180",
            "DirMapZone": "linux", # typically blades auto-select "nfs" or "unc"
            "SiteModulesPath": "/Volumes/dabrender/usr/custom/tractor",
            "EnvKeys": [ 
                         "@merge('show.generic.envkeys')", 
                          "@merge('shared.linux.envkeys')"  
                       ]
        },

<<<<<<< Updated upstream
        ######  render machines - 64 cores and lots of ram
        {   "ProfileName": "Linux64b",
            "Hosts": {"Name": [ 
                                #"dabrn02",
                                #"dabrn03",
                                #"dabrn04",
                                #"dabrn05",
                                #"dabrn06",
                                #"dabrn07",
			       ] },
            "UDI":3.0,
            "Provides": [ 
                          "PixarRender",
                          "PixarNRM",
                          "RMSRender",
                          "ShellServices",
                          "RfMRender", 
                          "MayaMentalRay",
                          #"RfMRibGen",
                          "PixarMTOR",
                          "HighMemory",
                          ],
            "Capacity": {
               "MaxSlots": 64,    # 0 -> use number of system CPUs
               "MaxLoad":  1.5,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
            },
          
            "CmdOutputLogging": "logserver=tractor-logger:9180",
            "DirMapZone": "linux", # typically blades auto-select "nfs" or "unc"
            "SiteModulesPath": "/Volumes/dabrender/usr/custom/tractor",
            "EnvKeys": [ 
                         "@merge('show.generic.envkeys')", 
                         "@merge('shared.linux.envkeys')"  
                       ]
        },
=======

>>>>>>> Stashed changes

	##########  lab  machines #####################
        {   "ProfileName": "OSXLab iMacs",
            "Hosts": {"Name": [
				"DABMDB0607749*",
                                "DABMDB0607738*",
                                "DABMDB0607739*"
			      ] },
            "UDI":2.0,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "Ffmpeg",
                         "NukeRender",
			             "ShellServices",
                         "OSXONLY",
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  0.8,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "SiteModulesPath": "/Volumes/dabrender/usr/custom/tractor",
            "EnvKeys": [ 
                         "@merge('shared.macosx.envkeys')", 
                         "@merge('nuke.macosx.envkeys')", 
                       ]
        },


	##########  lab  machines #####################
        {   "ProfileName": "OSXLab MacPros",
            "Hosts": {"Name": [
			       "DABMDB0607737*"
			      ] },
            "UDI":2.0,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "NukeRender",
                         "Ffmpeg",
			 "HighMemory",
                         "OSXONLY",
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  0.8,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ 
                         "@merge('shared.macosx.envkeys')", 
                         "@merge('nuke.macosx.envkeys')",  
                         "@merge('show.generic.envkeys')"  
                         #"@merge('maya.macosx.envkeys')" 
                       ]
        },

	

	##########  dab render box RIB GEN ONLY #####################
        {   "ProfileName": "OSX RIBGEN AND NUKE",
            "Hosts": {"Name": [
				#"DAB-render-box-1",
				"DAB-render-box-2",
				"DAB-render-box-3",
			      ] },
            "UDI":2.0,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender", 
                         "RfMRibGen", 
                         "PixarMTOR", 
                         "MayaMentalRay",
                         "NukeRender",
                         "Ffmpeg",
                         "OSXONLY",
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  0.8,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ 
                         "@merge('shared.macosx.envkeys')", 
                         "@merge('nuke.macosx.envkeys')",  
                         "@merge('show.generic.envkeys')"  
                         #"@merge('maya.macosx.envkeys')" 
                       ]
        },


	##########  dab render box TESTING and DEBUG  #####################
        {   "ProfileName": "OSX TESTING",
            "Hosts": {"Name": [
				"DAB-render-box-1",
			      ] },
            "UDI":2.0,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender", 
                         "RfMRibGen", 
                         "PixarMTOR", 
                         "MayaMentalRay",
                         "NukeRender",
                         "TESTING",
                         "Ffmpeg",
                         "OSXONLY",
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  0.8,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ 
                         "@merge('shared.macosx.envkeys')", 
                         "@merge('nuke.macosx.envkeys')",  
                         "@merge('show.generic.envkeys')"  
                         #"@merge('maya.macosx.envkeys')" 
                       ]
        },

	##########  lab photo  machines #####################
        {   "ProfileName": "OSXPhoto MacPros",
            "Hosts": {"Name": [
				"DABMDB06022*"
			      ] },
            "UDI":0.5,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "Ffmpeg",
                         "OSXONLY",
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  1.0,  # CPU load avg, normalized by cpu count
<<<<<<< Updated upstream
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
=======
               "MinRAM":   4.0,  # gigabytes
               "MinDisk":  1.0,  # gigabytes; alternatively: [1.0, "D:/"]
>>>>>>> Stashed changes
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ 
                         "@merge('shared.macosx.envkeys')",
                         "@merge('nuke.macosx.envkeys')",  
                         "@merge('show.generic.envkeys')"  
                         #"@merge('maya.macosx.envkeys')" 
                       ]
        },
	

	########  mattg desktop and anim lab tester
        {   "ProfileName": "OSX_Staff",
            "Hosts": {"Name": [
                                "DABMDB0606627MG"
                              ] },
            "UDI":0.1,
            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "Ffmpeg",
                         "OSXONLY",
                        ],

            "Capacity": {
               "MaxSlots": 4,    # 0 -> use number of system CPUs
               "MaxLoad":  1.0,  # CPU load avg, normalized by cpu count
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ "@merge('shared.macosx.envkeys')" ]
        },


        ######## Sound Booth Machines 
        {   "ProfileName": "OSX_Light_Duty",
            "Hosts": {"Name": [
                                "DABMDB060774601",
                                "DABMDB060774542",
                                "DABMDB060774541",
                              ] },
            "UDI":1.0,

            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "Ffmpeg",
                         "OSXONLY",
                        ],

            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
               "MaxLoad":  1.0,  # CPU load avg, normalized by cpu countName"
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ "@merge('shared.macosx.envkeys')" ]
        },



        ######## Simons Machine
        {   "ProfileName": "OSX_Light_Duty",
            "Hosts": {"Name": [
                                #"DABMDBanimbuild",
				"DABMDB0603303SH",
                              ] },
            "UDI":2.0,

            "Provides": [
                         "PixarRender", 
                         "PixarNRM",
                         "RfMRender",
                         "RfMRibGen",
                         "PixarMTOR",
                         "MayaMentalRay",
                         "Ffmpeg"
                        ],
            "Capacity": {
               "MaxSlots": 8,    # 0 -> use number of system CPUs
<<<<<<< Updated upstream
               "MaxLoad":  0.7,  # CPU load avg, normalized by cpu count
=======
               "MaxLoad":  0.5,  # CPU load avg, normalized by cpu count
>>>>>>> Stashed changes
               "MinRAM":   0.5,  # gigabytes
               "MinDisk":  500.0,  # gigabytes; alternatively: [1.0, "D:/"]
           },
            "CmdOutputLogging": "logserver=tractor-logger:9180",
	    "DirMapZone":"osx", 
            "EnvKeys": [ 
                          "@merge('shared.macosx.envkeys')" 
                       ]
       },


        ########  GENERIC PROFILES 
        {   "ProfileName": "Linux64",
            "Hosts": {"Platform": "Linux-*64bit*"},
            "EnvKeys": [ "@merge('shared.linux.envkeys')" ]
        },
        {   "ProfileName": "Linux32",
            "Hosts": {"Platform": "Linux-*"},
            "EnvKeys": [ "@merge('shared.linux.envkeys')" ]
        },
        {   "ProfileName": "Windows8",
            "Hosts": {"Platform": "Windows-*-6.2.*-64*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "Windows7",
            "Hosts": {"Platform": "Windows-*-6.1*-64*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "Windows7_32bit",
            "Hosts": {"Platform": "Windows-*-6.1*-32*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "WindowsVista64",
            "Hosts": {"Platform": "Windows-*-6.0*-64*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "WindowsVista32",
            "Hosts": {"Platform": "Windows-*-6.0*-32*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "WindowsXP",
            "Hosts": {"Platform": "Windows-*-5.1*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        {   "ProfileName": "Windows",
            "Notes": "fallback for any other windows release",
            "Hosts": {"Platform": "Windows*"},
            "EnvKeys": [ "@merge('shared.windows.envkeys')" ]
        },
        #{   "ProfileName": "MacOSX",
            #"Hosts": {"Platform": "Darwin-*"},
            #"EnvKeys": [ "@merge('shared.macosx.envkeys')" ]
        #}
    ]
}

